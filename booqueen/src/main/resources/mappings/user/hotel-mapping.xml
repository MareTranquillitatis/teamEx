<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.booqueen.user.hotel.dao.hotelmapper">
	
	<select id="selectHotels" resultType="hotelVO" parameterType="String">
		<![CDATA[SELECT * FROM temphotel where city LIKE CONCAT('%', #{city}, '%') or hotelname like CONCAT('%', #{city}, '%')]]>
	</select>
	
	<select id="selectHotel" resultType="hotelVO" parameterType="Integer">
		<![CDATA[SELECT * FROM temphotel where serialnumber = #{serialnumber}]]>
	</select>
	
	<select id="selectHotelImg" resultType="hotelImgVO" parameterType="Integer">
		<![CDATA[SELECT * FROM hotel_image where serialnumber = #{serialnumber}]]>
	</select>
	
	<resultMap type="hotelVO" id="HotelVOMap">
    	<id property="serialnumber" column="serialnumber"/>
		<result property="hotelname" column="hotelname"/>
		<result property="address1" column="address1"/>
		<result property="address2" column="address2"/>
		<result property="postalcode" column="postalcode"/>
		<result property="city" column="city"/>
		<result property="telephone" column="telephone"/>
		<result property="star" column="star"/>
		<collection property="hotelImgVO" resultMap="HotelImgVOMap" />
		<collection property="reviewAvgVO"	resultMap="ReviewAvgVOMap"/>	
    </resultMap>

	<resultMap type="hotelImgVO" id="HotelImgVOMap">
   		<result property="file_name" column="file_name"/>
   		<result property="file_url" column="file_url"/>
   </resultMap>
   
   <resultMap type="reviewAvgVO" id="ReviewAvgVOMap">
   		<result property="scoreAvg" column="score"/>
   		<result property="count" column="count"/>
   </resultMap>

	<select id="selectHotelWithImg" resultMap="HotelVOMap" parameterType="String">
		<![CDATA[
				select t.serialnumber, t.hotelname , t.address1, t.address2, t.postalcode, t.city,
	
				t.telephone, t.star, h.file_name, h.file_url, round(avg(r.score), 1) as score, count(r.username) 
				
				from hotel_image as h 
				
				full join temphotel as t
				
				on h.serialnumber = t.serialnumber
				
				full join review as r
				
				on t.serialnumber = r.serialnumber
				
				where t.city LIKE CONCAT('%', #{city}, '%')
				
				group by t.serialnumber, h.file_name, h.file_url
		]]>
	</select>
	
	<select id="selectFilterByStar" resultMap="HotelVOMap" parameterType="java.util.ArrayList">
		<![CDATA[ 
			select t.serialnumber, t.hotelname , t.address1, t.address2, t.postalcode, t.city,
	
				t.telephone, t.star, h.file_name, h.file_url, round(avg(r.score), 1) as score, count(r.username) 
				
				from hotel_image as h 
				
				full join temphotel as t
				
				on h.serialnumber = t.serialnumber
				
				full join review as r
				
				on t.serialnumber = r.serialnumber
				
				where star in (
		]]>			
				<foreach collection="array" item="item" separator="," index="index">
       				 <![CDATA[ #{item}]]>	
   	 			</foreach>
		<![CDATA[		
				)
				
				group by t.serialnumber, h.file_name, h.file_url
				]]>	
	</select>
	
</mapper>